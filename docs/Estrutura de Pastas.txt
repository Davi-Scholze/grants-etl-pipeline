================================================================================
ğŸ—ï¸  ESTRUTURA COMPLETA DO PROJETO - GRANTS MANAGEMENT ETL PIPELINE
================================================================================
Ãšltima atualizaÃ§Ã£o: Fevereiro 2026
Status: 100% FUNCIONAL E DOCUMENTADO âœ…

================================================================================
ğŸ“ RAIZ DO PROJETO
================================================================================

Grants Management ETL Pipeline/
â”‚
â”œâ”€â”€ ğŸ” .env                              CONFIGURAÃ‡ÃƒO SENSÃVEL (seu arquivo pessoal)
â”‚   â”‚   # NUNCA commitar no Git! (adicione ao .gitignore)
â”‚   â”‚   # ContÃ©m: DIR_DOWNLOADS, DIR_STAGING, CONN_STR_SQLSERVER
â”‚   â”‚   # Criado a partir do .env.template
â”‚   â”‚
â”‚   â””â”€â”€ Exemplo:
â”‚       DIR_DOWNLOADS=C:\Users\usuario\Downloads
â”‚       DIR_STAGING=C:\Users\usuario\Documents\...\data\processed
â”‚       CONN_STR_SQLSERVER=Driver={ODBC Driver 17...}
â”‚
â”œâ”€â”€ ğŸ“ .env.template                     TEMPLATE DO .env (SEGURO PARA GIT)
â”‚   â”‚   # CÃ³pia do .env sem dados sensÃ­veis
â”‚   â”‚   # Use como referÃªncia para criar seu .env
â”‚   â”‚   # ContÃ©m comentÃ¡rios explicativos
â”‚   â”‚
â”‚   â””â”€â”€ INSTRUÃ‡Ã•ES: copy .env.template .env (no Windows)
â”‚
â”œâ”€â”€ ğŸ“¦ requirements.txt                  DEPENDÃŠNCIAS PYTHON
â”‚   â”‚   # pip install -r requirements.txt
â”‚   â”‚   # ContÃ©m todas as bibliotecas necessÃ¡rias
â”‚   â”‚
â”‚   â””â”€â”€ EXECUTE ANTES: pip install -r requirements.txt
â”‚
â”œâ”€â”€ ğŸ³ Dockerfile                        IMAGEM DOCKER (Linux + Python + ODBC)
â”‚   â”‚   # NÃ£o execute manualmente - use docker-compose
â”‚   â”‚
â”‚   â””â”€â”€ USAR: docker-compose build
â”‚
â”œâ”€â”€ ğŸ‹ docker-compose.yaml               ORQUESTRAÃ‡ÃƒO DOCKER
â”‚   â”‚   # Services: sqlserver (SQL Server 2022) + etl_pipeline (Python)
â”‚   â”‚
â”‚   â””â”€â”€ USAR: docker-compose up
â”‚
â”œâ”€â”€ ğŸ“š GUIA_COMPLETO.md                  DOCUMENTAÃ‡ÃƒO PROFISSIONAL ğŸ“š
â”‚   â”‚   # LEIA ISTO PRIMEIRO!
â”‚   â”‚   # ExplicaÃ§Ã£o completa de cada etapa
â”‚   â”‚   # Diagramas, exemplos, troubleshooting
â”‚   â”‚
â”‚   â””â”€â”€ ESSENCIAL: Ler antes de usar o pipeline
â”‚
â””â”€â”€ docs/Estrutura de Pastas.txt          ESTE ARQUIVO


================================================================================
ğŸ“ DATA/ - DADOS (RAW â†’ PROCESSED)
================================================================================

data/
â”‚
â”œâ”€â”€ raw/                                 ğŸ“¥ ENTRADA (DADOS BRUTOS)
â”‚   â”‚   # Arquivos que vocÃª coloca aqui (ou main.py copia de Downloads)
â”‚   â”‚   # ExtensÃµes aceitas: .xlsx, .xls, .csv
â”‚   â”‚
â”‚   â”œâ”€â”€ Despesas_SIT_57884.xlsx          â† Um arquivo para cada SIT
â”‚   â”œâ”€â”€ Despesas_SIT_63377.xlsx
â”‚   â”œâ”€â”€ resumo_financeiro.csv            â† Arquivo consolidado
â”‚   â””â”€â”€ (mais arquivos conforme necessÃ¡rio)
â”‚
â”‚   FLUXO: Downloads/ â†’ main.py â†’ raw/ â†’ Extract
â”‚
â””â”€â”€ processed/                           ğŸ­ PROCESSAMENTO/SAÃDA
    â”‚   # Criado automaticamente pelo pipeline
    â”‚
    â”œâ”€â”€ despesas_geral.csv               â† ETAPA 1: ConsolidaÃ§Ã£o
    â”‚   â”‚   # Todos os XLSXs consolidados
    â”‚   â”‚
    â”‚   â”œâ”€â”€ despesas_upload.csv           â† ETAPA 2: Para carregar
    â”‚   â”‚   â”‚   # Com coluna 'acao' (INSERT|UPDATE)
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ despesas_upload.processado.csv  â† ETAPA 3: HistÃ³rico
    â”‚   â”‚
    â”‚   â”œâ”€â”€ resumo_termos.csv            â† ETAPA 1: Termos extraÃ­dos
    â”‚   â”‚   â”‚   # Colunas: nro_sit | rendimento_financeiro_total
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ update_termos.csv        â† ETAPA 2: DivergÃªncias (OPCIONAL)
    â”‚   â”‚
    â”‚   â”œâ”€â”€ resumo_rubricas.csv          â† ETAPA 1: Rubricas extraÃ­das
    â”‚   â”‚   â”‚   # Colunas: nro_sit | rubrica | valor_estornado | id_termo_rubrica
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ update_rubricas.csv      â† ETAPA 2: DivergÃªncias (OPCIONAL)
    â”‚   â”‚
    â”‚   â””â”€â”€ (arquivos temporÃ¡rios)


================================================================================
ğŸ“ DATABASE/ - SCRIPTS SQL
================================================================================

database/
â”‚
â”œâ”€â”€ ddl/                                 ğŸ—ï¸ DDL (CRIAÃ‡ÃƒO DE TABELAS)
â”‚   â”‚   # Scripts de CRIAÃ‡ÃƒO (Schema)
â”‚   â”‚   # Executar uma Ãºnica vez no inÃ­cio
â”‚   â”‚
â”‚   â”œâ”€â”€ estrutura_dbo_despesas.sql       â† Tabela principal: despesas
â”‚   â”œâ”€â”€ estrutura_dbo_favorecidos.sql    â† Tabela: favorecidos
â”‚   â”œâ”€â”€ estrutura_dbo_rubricas.sql       â† Tabela: rubricas
â”‚   â”œâ”€â”€ estrutura_dbo_termos.sql         â† Tabela: termos
â”‚   â””â”€â”€ estrutura_dbo_vagas_termos.sql   â† Tabela: vagas_termos
â”‚
â”œâ”€â”€ dml/                                 ğŸ“ DML (LÃ“GICA/REGRAS)
â”‚   â”‚   # Scripts de ATUALIZAÃ‡ÃƒO/LÃ“GICA
â”‚   â”‚
â”‚   â””â”€â”€ update_rules.sql                 â† Regras de atualizaÃ§Ã£o
â”‚
â””â”€â”€ scripts_auxiliares/                  ğŸ”§ SCRIPTS AD-HOC
    â”‚   # Scripts de manutenÃ§Ã£o, debugging, testes
    â”‚
    â”œâ”€â”€ 13-funcionarios.sql
    â”œâ”€â”€ 13-termos.sql
    â”œâ”€â”€ atualizacao_favorecidos.sql
    â”œâ”€â”€ atualizacao_vagas_termos.sql
    â”œâ”€â”€ EXCLUI e ATUALIZA.sql            â† CUIDADO: Limpeza
    â”œâ”€â”€ RH.sql
    â””â”€â”€ SQLQuery1.sql


================================================================================
ğŸ“ DOCS/ - DOCUMENTAÃ‡ÃƒO
================================================================================

docs/
â”œâ”€â”€ Estrutura de Pastas.txt              â† ESTE ARQUIVO
â””â”€â”€ (README.md se houver)


================================================================================
ğŸ“ LOGS/ - HISTÃ“RICO DE EXECUÃ‡ÃƒO
================================================================================

logs/
â”‚
â”œâ”€â”€ MainPipeline_20260209_143022.log     â† Log principal completo
â”œâ”€â”€ ExpensesExtractor_20260209_143022.log â† Log Etapa 1 (detalhado)
â”œâ”€â”€ ExpensesTransformer_20260209_143025.log â† Log Etapa 2 (detalhado)
â””â”€â”€ ExpensesLoader_20260209_143030.log   â† Log Etapa 3 (detalhado)

# Novos arquivos criados A CADA execuÃ§Ã£o
# FormataÃ§Ã£o: {ModuleName}_{YYYYMMDD}_{HHMMSS}.log


================================================================================
ğŸ“ REPORTS/ - DASHBOARDS
================================================================================

reports/
â”‚
â”œâ”€â”€ Controle de RH Por ConvÃªnio.pbix     ğŸ“Š Dashboard Power BI (RH)
â””â”€â”€ Grants_Dashboard.pbix                ğŸ“Š Dashboard Principal (VisÃ£o geral)

# Conectam diretamente ao SQL Server
# AtualizaÃ§Ã£o: manual (F9 no Power BI)


================================================================================
ğŸ“ SRC/ - CÃ“DIGO-FONTE PYTHON ğŸ§ 
================================================================================

src/
â”‚
â”œâ”€â”€ â­ main.py                           ORQUESTRADOR PRINCIPAL
â”‚   â”‚   # EXECUTE: python -m src.main
â”‚   â”‚
â”‚   â”‚   FLUXO:
â”‚   â”‚   1. Valida .env
â”‚   â”‚   2. Sincroniza Downloads â†’ data/raw (automÃ¡tico!)
â”‚   â”‚   3. ExtraÃ§Ã£o (Etapa 1)
â”‚   â”‚   4. TransformaÃ§Ã£o (Etapa 2)
â”‚   â”‚   5. â¸ï¸ PAUSA: confirmaÃ§Ã£o (vocÃª digita SIM)
â”‚   â”‚   6. Carga (Etapa 3) - SOMENTE SE CONFIRMOU
â”‚   â”‚   7. FIM: resumo e logs
â”‚   â”‚
â”‚   â””â”€â”€ FUNÃ‡ÃƒO NOVA: validar_e_confirmar() â† mostra dados antes de atualizar
â”‚
â”œâ”€â”€ ğŸ“ extract/                          ğŸ“¥ ETAPA 1: EXTRAÃ‡ÃƒO
â”‚   â”‚   # LÃª XLSX/CSV brutos â†’ consolida em CSVs padronizados
â”‚   â”‚
â”‚   â”œâ”€â”€ expenses.py                      âœ… NOVO: Wrapper (USE ISTO!)
â”‚   â”‚   â”‚   # Classe: ExpensesExtractor
â”‚   â”‚   â”‚   # MÃ©todo: run()
â”‚   â”‚   â”‚   # Entrada: data/raw/*.xlsx + .csv
â”‚   â”‚   â”‚   # SaÃ­da: despesas_geral.csv + resumos
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ 1_extract_csv.py             (Script original - referÃªncia)
â”‚   â”‚   â””â”€â”€ 1_extract_resumo.py          (Script original - referÃªncia)
â”‚
â”œâ”€â”€ ğŸ“ transform/                        ğŸ”„ ETAPA 2: TRANSFORMAÃ‡ÃƒO
â”‚   â”‚   # Compara com banco + valida divergÃªncias
â”‚   â”‚
â”‚   â”œâ”€â”€ transformer.py                   âœ… NOVO: Wrapper (USE ISTO!)
â”‚   â”‚   â”‚   # Classe: ExpensesTransformer
â”‚   â”‚   â”‚   # MÃ©todo: run()
â”‚   â”‚   â”‚   # Entrada: despesas_geral.csv + SQL Server
â”‚   â”‚   â”‚   # SaÃ­da: despesas_upload.csv + updates opcionais
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ 2_transform_compare.py       (Script original - referÃªncia)
â”‚   â”‚   â””â”€â”€ 2_validate.py                (Script original - referÃªncia)
â”‚
â”œâ”€â”€ ğŸ“ load/                             ğŸ“¤ ETAPA 3: CARGA
â”‚   â”‚   # Escreve no SQL Server (INSERT/UPDATE)
â”‚   â”‚
â”‚   â”œâ”€â”€ loader.py                        âœ… NOVO: Wrapper (USE ISTO!)
â”‚   â”‚   â”‚   # Classe: ExpensesLoader
â”‚   â”‚   â”‚   # MÃ©todo: run()
â”‚   â”‚   â”‚   # Entrada: despesas_upload.csv + updates
â”‚   â”‚   â”‚   # SaÃ­da: Banco atualizado
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ 3_load_sql.py                (Script original - referÃªncia)
â”‚   â”‚   â””â”€â”€ 3_update_sql.py              (Script original - referÃªncia)
â”‚
â””â”€â”€ ğŸ“ utils/                            ğŸ”§ MÃ“DULOS COMPARTILHADOS
    â”‚   # Importados por todos
    â”‚
    â”œâ”€â”€ logger.py                        âœ… NOVO: Logging centralizado
    â”‚   â”‚   # FunÃ§Ã£o: setup_logger(name, log_dir)
    â”‚   â”‚   # Cria logs em: logs/{name}_{timestamp}.log
    â”‚   â”‚
    â”œâ”€â”€ config.py                        âœ… NOVO: ConfiguraÃ§Ãµes
    â”‚   â”‚   # Classe: Config
    â”‚   â”‚   # Carrega .env
    â”‚   â”‚   # ContÃ©m: DIR_*, CONN_STR, SIT_TERMO_MAP, MAPEAMENTO_DESPESAS
    â”‚   â”‚   # MÃ©todo: validate() â† verifica .env
    â”‚   â”‚
    â”œâ”€â”€ database.py                      âœ… NOVO: Gerenciador de BD
    â”‚   â”‚   # Classe: DatabaseManager
    â”‚   â”‚   # MÃ©todos: get_connection(), execute_query(), execute_insert_update()
    â”‚   â”‚
    â”œâ”€â”€ ingestor.py                      âœ… NOVO: FunÃ§Ãµes sanitizadoras
    â”‚   â”‚   # FunÃ§Ãµes: classificar_tipo_despesa(), limpar_cpf_cnpj(), etc
    â”‚   â”‚   # FUNÃ‡ÃƒO PRINCIPAL: copiar_downloads_para_raw()
    â”‚   â”‚   #   â””â”€ Move arquivos de Downloads â†’ raw (automÃ¡tico!)
    â”‚   â”‚
    â”œâ”€â”€ README.md                        ğŸ“š DocumentaÃ§Ã£o do src/
    â”‚
    â””â”€â”€ __pycache__/                     ğŸš« IGNORAR (cache Python)


================================================================================
ğŸ“ TESTS/ - TESTES
================================================================================

tests/
â””â”€â”€ 1.0_extract_csv.py                   ğŸ§ª Script de teste (opcional)


================================================================================
ğŸ¯ RESUMO EXECUTIVO
================================================================================

ARQUITETURA:

    Downloads/ â†’ main.py (copia) â†’ data/raw/
         â†“
    Etapa 1: EXTRAÃ‡ÃƒO (expenses.py)
         â†“
    Etapa 2: TRANSFORMAÃ‡ÃƒO (transformer.py)
         â†“
    â¸ï¸ PAUSA: ConfirmaÃ§Ã£o (validar_e_confirmar)
         â†“
    Etapa 3: CARGA (loader.py)
         â†“
    âœ… Banco de Dados Atualizado!


COMO USAR:

    1. pip install -r requirements.txt
    2. copy .env.template .env
    3. Editar .env com seus dados
    4. Colocar arquivos em Downloads/
    5. python -m src.main
    6. Digitar: SIM (para confirmar)
    7. Ver logs em logs/


ARQUIVOS IMPORTANTES:

    .env                â† Configure isso PRIMEIRO
    src/main.py         â† Execute isso!
    GUIA_COMPLETO.md    â† Leia para entender tudo
    Dockerfile          â† Para Docker (opcional)


================================================================================
âœ… CHECKLIST ANTES DE RODAR
================================================================================

â–¡ Python 3.8+ instalado
â–¡ requirements.txt instalado
â–¡ .env criado e configurado
â–¡ SQL Server rodando
â–¡ ODBC Driver 17 instalado (Windows)
â–¡ Arquivos em Downloads/ ou data/raw/
â–¡ Database/ddl scripts executados (setup inicial)


================================================================================
ğŸ“ DÃšVIDAS?
================================================================================

â†’ GUIA_COMPLETO.md       (documentaÃ§Ã£o completa e didÃ¡tica)
â†’ logs/*.log             (arquivos de execuÃ§Ã£o)
â†’ src/README.md          (como usar o cÃ³digo)


================================================================================
FIM - Fevereiro 2026 âœ…
================================================================================
